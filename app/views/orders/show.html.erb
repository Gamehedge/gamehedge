<span ng-app="gamehedge">
    <div>
        <div class="dark-header">
            <nav class="navbar navbar-default navbar-gamehedge vertical-center" role="navigation">

                <div class="col-xs-2 hidden-md hidden-lg">
                    
                </div>
                <div class="navbar-header col-md-4 col-xs-8">
                    <a href="/">
                        <img class="logo-image" alt="GameHedge.com" src="https://d2fj37dggc6l3c.cloudfront.net/assets/images/logo.png">
                    </a>
                </div>

                
                  <div class="navbar-header col-md-8 hidden-xs hidden-xm vertical-center help hidden">
                      
                    <p>NEED HELP? CALL TOLL FREE <br><span>(888) 804-4330</span></p>
                    <img class="help-image" alt="Call Us" src="https://d2fj37dggc6l3c.cloudfront.net/assets/images/help.png">
                
                </div>
            </nav>
        </div>
        <div class="view-container" ng-controller="EventController">
            <div class="view-frame animate-view">
               <div id="home-loading-data" class="row horizontal-center" ng-if="!clientLoaded || !ticketsLoaded">
                  <div class='uil-default-css' style='transform:scale(0.32);'><div style='top:80px;left:93px;width:14px;height:40px;background:#000000;-webkit-transform:rotate(0deg) translate(0,-60px);transform:rotate(0deg) translate(0,-60px);border-radius:10px;position:absolute;'></div><div style='top:80px;left:93px;width:14px;height:40px;background:#000000;-webkit-transform:rotate(30deg) translate(0,-60px);transform:rotate(30deg) translate(0,-60px);border-radius:10px;position:absolute;'></div><div style='top:80px;left:93px;width:14px;height:40px;background:#000000;-webkit-transform:rotate(60deg) translate(0,-60px);transform:rotate(60deg) translate(0,-60px);border-radius:10px;position:absolute;'></div><div style='top:80px;left:93px;width:14px;height:40px;background:#000000;-webkit-transform:rotate(90deg) translate(0,-60px);transform:rotate(90deg) translate(0,-60px);border-radius:10px;position:absolute;'></div><div style='top:80px;left:93px;width:14px;height:40px;background:#000000;-webkit-transform:rotate(120deg) translate(0,-60px);transform:rotate(120deg) translate(0,-60px);border-radius:10px;position:absolute;'></div><div style='top:80px;left:93px;width:14px;height:40px;background:#000000;-webkit-transform:rotate(150deg) translate(0,-60px);transform:rotate(150deg) translate(0,-60px);border-radius:10px;position:absolute;'></div><div style='top:80px;left:93px;width:14px;height:40px;background:#000000;-webkit-transform:rotate(180deg) translate(0,-60px);transform:rotate(180deg) translate(0,-60px);border-radius:10px;position:absolute;'></div><div style='top:80px;left:93px;width:14px;height:40px;background:#000000;-webkit-transform:rotate(210deg) translate(0,-60px);transform:rotate(210deg) translate(0,-60px);border-radius:10px;position:absolute;'></div><div style='top:80px;left:93px;width:14px;height:40px;background:#000000;-webkit-transform:rotate(240deg) translate(0,-60px);transform:rotate(240deg) translate(0,-60px);border-radius:10px;position:absolute;'></div><div style='top:80px;left:93px;width:14px;height:40px;background:#000000;-webkit-transform:rotate(270deg) translate(0,-60px);transform:rotate(270deg) translate(0,-60px);border-radius:10px;position:absolute;'></div><div style='top:80px;left:93px;width:14px;height:40px;background:#000000;-webkit-transform:rotate(300deg) translate(0,-60px);transform:rotate(300deg) translate(0,-60px);border-radius:10px;position:absolute;'></div><div style='top:80px;left:93px;width:14px;height:40px;background:#000000;-webkit-transform:rotate(330deg) translate(0,-60px);transform:rotate(330deg) translate(0,-60px);border-radius:10px;position:absolute;'></div>
                  </div>
                </div>
                <span id="home" ng-show="clientLoaded && ticketsLoaded">
                  <section id="payments" ng-show="!order_success">
                      <div class="container">
                            <div class="row hidden-md hidden-lg hidden-xl">
                                <div class="col-xs-12 text-right order-tel">
                                    <span style="font-size: 0.8em;">Contact us</span> <i style="color:#A8C94B; font-size: 1.2em;" class="fa fa-phone-square" aria-hidden="true"></i> Toll free <a href="tel:8888044330">888-804-4330</a>    
                                </div>
                            </div>
                        <div class="row row-eq-height payment-container">
                          <div class="col-md-8 card-element">
                            <div class="card">
                              <div class="card-in summary hidden-md hidden-lg hidden-xl" style="padding-bottom:0;">
                                <div class="title">{{ticket.event.name}}</div>
                                <div class="info">
                                  {{event.occurs_at | date: "EEE, MMM dd, yyyy hh:mm a" : 'UTC'}}<br>
                                  {{event.venue.name}}, {{event.venue.location}}<br>
                                  <div class="top-location"><strong class="info-summary">Section {{ticket.section}}</strong></div>
                                                <div class="top-info-price">
                                                    <strong>Row {{ticket.row}}</strong>
                                                    <div class="price-top-mobile">{{ticket.retail_price | currency}} ea.</div>
                                                </div>
                                                
                                                
                                </div>
                                            <div class="top-desc-container">
                                  <div class="description top-desc">Quantity</div>
                                  <div class="top-val mobile-margin-select" >
                                    <select class="mobile-top-amount" id="amount" ng-model="amount" ng-change="calculateValues()" >
                                      <option ng-repeat="o in ticket.splits | orderBy:'-'" value="{{o}}">{{o}}</option>
                                    </select>
                                  </div>
                                </div>
                              </div>
                              <div class="card-in deliver">
                                Deliver tickets to
                                <div ng-if="edit_deliver == 4">
                                  <span>
                                    <div class="inputs">
                                      <div class="email left">
                                        <input type="email" class="form-control" id="email" placeholder="Email" ng-model="$parent.client.email" name="email" ng-change="checkEmail()">
                                    </div>
                                    <div class="email right">
                                        <input type="email" class="form-control" id="email-confirm" placeholder="Confirm Email"  ng-model="$parent.client.confirm_email" name="confirm_email">
                                    </div>
                                  </div>
                                </span>
                                </div>
                                <div class="review" ng-if="edit_deliver == 2">
                                  <div ng-repeat="a in addresses" style="display:flex;">
                                    <input type="radio" ng-model="$parent.$parent.shipping_address_index" value="{{$index}}">
                                    <div>
                                      <div class="title">{{a.name}}</div>
                                      <div>{{a.street_address}}<br>
                                      {{a.locality}}, {{a.region}} {{a.postal_code}}<br>
                                      {{a.country_code}}</div>
                                    </div>
                                  </div>
                                  <span ng-if="!addresses.length">
                                    <div class="title">No addresses</div>
                                  </span>
                                  <button ng-disabled="$parent.processing" ng-click="selectAddress('shipping')">DONE</button><button ng-disabled="$parent.processing" ng-click="addField('shipping')">ADD</button>
                                </div>
                                <div class="review" ng-if="edit_deliver == 1">
                                  <span ng-if="addresses.length">
                                    <div class="title">{{shipping_address.name}}</div>
                                    <span>
                                      <div>{{client.email}}</div>
                                    </span>
                                    <div>{{shipping_address.street_address}}<br>
                                    {{shipping_address.locality}}, {{shipping_address.region}} {{shipping_address.postal_code}}<br>
                                    {{shipping_address.country_code}}</div>
                                  </span>
                                  <span ng-if="!addresses.length">
                                    <div class="title">No addresses</div>
                                  </span>
                                  <button ng-disabled="$parent.processing" ng-click="toogleReview('deliver')">EDIT</button>
                                </div>
                                <div ng-if="edit_deliver == 3">
                                  <div class="mobile-margin inputs mobile-email" ng-if="!$root.isLoggedin">
                                    <div class="email bottom-line">
                                      <input type="email" class="form-control" id="email-shipping" ng-model="$parent.$parent.client.email" placeholder="Email" name="email"  ng-change="checkEmail()">
                                    </div>
                                    <div class="confirm-email">
                                      <input type="email" class="form-control" id="confirm-email-shipping" ng-model="$parent.$parent.client.confirm_email" placeholder="Confirm Email" name="confirm_email">
                                    </div>
                                  </div>
                                  <div class="inputs" ng-if="$root.isLoggedin">
                                    <div class="full-name">
                                      <input type="text" class="form-control" id="first-name-billing" ng-model="$parent.$parent.shipping_address.name" placeholder="Name as it appears on card" name="name">
                                    </div>
                                  </div>
                                  <div class="inputs" ng-if="$root.isLoggedin">
                                    <div class="address">
                                      <input type="text" class="form-control" id="address-billing" ng-model="$parent.$parent.shipping_address.street_address" placeholder="Address" name="address">
                                    </div>
                                    <div class="country">
                                      <select id="country-billing" ng-model="$parent.$parent.shipping_address.country_code" name="country">
                                      <option value="">Select Country</option>
                                      <option value="us">United States</option>
                                      <option value="af">Afghanistan</option>
                                      <option value="al">Albania</option>
                                      <option value="dz">Algeria</option>
                                      <option value="as">American Samoa</option>
                                      <option value="ad">Andorra</option>
                                      <option value="ao">Angola</option>
                                      <option value="ai">Anguilla</option>
                                      <option value="aq">Antarctica</option>
                                      <option value="ag">Antigua and Barbuda</option>
                                      <option value="ar">Argentina</option>
                                      <option value="am">Armenia</option>
                                      <option value="aw">Aruba</option>
                                      <option value="au">Australia</option>
                                      <option value="at">Austria</option>
                                      <option value="az">Azerbaijan</option>
                                      <option value="bs">Bahamas</option>
                                      <option value="bh">Bahrain</option>
                                      <option value="bd">Bangladesh</option>
                                      <option value="bb">Barbados</option>
                                      <option value="by">Belarus</option>
                                      <option value="be">Belgium</option>
                                      <option value="bz">Belize</option>
                                      <option value="bj">Benin</option>
                                      <option value="bm">Bermuda</option>
                                      <option value="bt">Bhutan</option>
                                      <option value="bo">Bolivia</option>
                                      <option value="ba">Bosnia and Herzegovina</option>
                                      <option value="bw">Botswana</option>
                                      <option value="bv">Bouvet Island</option>
                                      <option value="br">Brazil</option>
                                      <option value="io">British Indian Ocean Territory</option>
                                      <option value="vg">British Virgin Islands</option>
                                      <option value="bn">Brunei Darussalam</option>
                                      <option value="bg">Bulgaria</option>
                                      <option value="bf">Burkina Faso</option>
                                      <option value="bi">Burundi</option>
                                      <option value="kh">Cambodia</option>
                                      <option value="cm">Cameroon</option>
                                      <option value="ca">Canada</option>
                                      <option value="cv">Cape Verde</option>
                                      <option value="ky">Cayman Islands</option>
                                      <option value="cf">Central African Republic</option>
                                      <option value="td">Chad</option>
                                      <option value="cl">Chile</option>
                                      <option value="cn">China</option>
                                      <option value="cx">Christmas Island</option>
                                      <option value="cc">Cocos (Keeling) Islands</option>
                                      <option value="co">Colombia</option>
                                      <option value="km">Comoros</option>
                                      <option value="cg">Congo-Brazzaville</option>
                                      <option value="cd">Congo-Kinshasa</option>
                                      <option value="ck">Cook Islands</option>
                                      <option value="cr">Costa Rica</option>
                                      <option value="hr">Croatia</option>
                                      <option value="cu">Cuba</option>
                                      <option value="cy">Cyprus</option>
                                      <option value="cz">Czech Republic</option>
                                      <option value="dk">Denmark</option>
                                      <option value="dj">Djibouti</option>
                                      <option value="dm">Dominica</option>
                                      <option value="do">Dominican Republic</option>
                                      <option value="ec">Ecuador</option>
                                      <option value="eg">Egypt</option>
                                      <option value="sv">El Salvador</option>
                                      <option value="gq">Equatorial Guinea</option>
                                      <option value="er">Eritrea</option>
                                      <option value="ee">Estonia</option>
                                      <option value="et">Ethiopia</option>
                                      <option value="fk">Falkland Islands (Malvinas)</option>
                                      <option value="fo">Faroe Islands</option>
                                      <option value="fj">Fiji</option>
                                      <option value="fi">Finland</option>
                                      <option value="fr">France</option>
                                      <option value="gf">French Guiana</option>
                                      <option value="pf">French Polynesia</option>
                                      <option value="tf">French Southern Territories</option>
                                      <option value="ga">Gabon</option>
                                      <option value="gm">Gambia</option>
                                      <option value="ge">Georgia</option>
                                      <option value="de">Germany</option>
                                      <option value="gh">Ghana</option>
                                      <option value="gi">Gibraltar</option>
                                      <option value="gr">Greece</option>
                                      <option value="gl">Greenland</option>
                                      <option value="gd">Grenada</option>
                                      <option value="gp">Guadeloupe</option>
                                      <option value="gu">Guam</option>
                                      <option value="gt">Guatemala</option>
                                      <option value="gg">Guernsey</option>
                                      <option value="gn">Guinea</option>
                                      <option value="gw">Guinea-Bissau</option>
                                      <option value="gy">Guyana</option>
                                      <option value="ht">Haiti</option>
                                      <option value="hm">Heard Island and McDonald Islands</option>
                                      <option value="hn">Honduras</option>
                                      <option value="hk">Hong Kong</option>
                                      <option value="hu">Hungary</option>
                                      <option value="is">Iceland</option>
                                      <option value="in">India</option>
                                      <option value="id">Indonesia</option>
                                      <option value="ir">Iran</option>
                                      <option value="iq">Iraq</option>
                                      <option value="ie">Ireland</option>
                                      <option value="im">Isle of Man</option>
                                      <option value="il">Israel</option>
                                      <option value="it">Italy</option>
                                      <option value="ci">Ivory Coast</option>
                                      <option value="jm">Jamaica</option>
                                      <option value="jp">Japan</option>
                                      <option value="je">Jersey</option>
                                      <option value="jo">Jordan</option>
                                      <option value="kz">Kazakhstan</option>
                                      <option value="ke">Kenya</option>
                                      <option value="ki">Kiribati</option>
                                      <option value="kw">Kuwait</option>
                                      <option value="kg">Kyrgyzstan</option>
                                      <option value="la">Laos</option>
                                      <option value="lv">Latvia</option>
                                      <option value="lb">Lebanon</option>
                                      <option value="ls">Lesotho</option>
                                      <option value="lr">Liberia</option>
                                      <option value="ly">Libya</option>
                                      <option value="li">Liechtenstein</option>
                                      <option value="lt">Lithuania</option>
                                      <option value="lu">Luxembourg</option>
                                      <option value="mo">Macao</option>
                                      <option value="mk">Macedonia, F.Y.R. of</option>
                                      <option value="mg">Madagascar</option>
                                      <option value="mw">Malawi</option>
                                      <option value="my">Malaysia</option>
                                      <option value="mv">Maldives</option>
                                      <option value="ml">Mali</option>
                                      <option value="mt">Malta</option>
                                      <option value="mh">Marshall Islands</option>
                                      <option value="mq">Martinique</option>
                                      <option value="mr">Mauritania</option>
                                      <option value="mu">Mauritius</option>
                                      <option value="yt">Mayotte</option>
                                      <option value="mx">Mexico</option>
                                      <option value="fm">Micronesia</option>
                                      <option value="md">Moldova</option>
                                      <option value="mc">Monaco</option>
                                      <option value="mn">Mongolia</option>
                                      <option value="me">Montenegro</option>
                                      <option value="ms">Montserrat</option>
                                      <option value="ma">Morocco</option>
                                      <option value="mz">Mozambique</option>
                                      <option value="mm">Myanmar</option>
                                      <option value="na">Namibia</option>
                                      <option value="nr">Nauru</option>
                                      <option value="np">Nepal</option>
                                      <option value="nl">Netherlands</option>
                                      <option value="an">Netherlands Antilles</option>
                                      <option value="nc">New Caledonia</option>
                                      <option value="nz">New Zealand</option>
                                      <option value="ni">Nicaragua</option>
                                      <option value="ne">Niger</option>
                                      <option value="ng">Nigeria</option>
                                      <option value="nu">Niue</option>
                                      <option value="nf">Norfolk Island</option>
                                      <option value="kp">North Korea</option>
                                      <option value="mp">Northern Mariana Islands</option>
                                      <option value="no">Norway</option>
                                      <option value="ps">Occupied Palestinian Territory</option>
                                      <option value="om">Oman</option>
                                      <option value="pk">Pakistan</option>
                                      <option value="pw">Palau</option>
                                      <option value="pa">Panama</option>
                                      <option value="pg">Papua New Guinea</option>
                                      <option value="py">Paraguay</option>
                                      <option value="pe">Peru</option>
                                      <option value="ph">Philippines</option>
                                      <option value="pn">Pitcairn</option>
                                      <option value="pl">Poland</option>
                                      <option value="pt">Portugal</option>
                                      <option value="pr">Puerto Rico</option>
                                      <option value="qa">Qatar</option>
                                      <option value="re">Reunion</option>
                                      <option value="ro">Romania</option>
                                      <option value="ru">Russian Federation</option>
                                      <option value="rw">Rwanda</option>
                                      <option value="bl">Saint Barthélemy</option>
                                      <option value="sh">Saint Helena</option>
                                      <option value="kn">Saint Kitts and Nevis</option>
                                      <option value="lc">Saint Lucia</option>
                                      <option value="mf">Saint Martin</option>
                                      <option value="pm">Saint Pierre and Miquelon</option>
                                      <option value="vc">Saint Vincent and the Grenadines</option>
                                      <option value="ws">Samoa</option>
                                      <option value="sm">San Marino</option>
                                      <option value="st">Sao Tome and Principe</option>
                                      <option value="sa">Saudi Arabia</option>
                                      <option value="sn">Senegal</option>
                                      <option value="rs">Serbia</option>
                                      <option value="sc">Seychelles</option>
                                      <option value="sl">Sierra Leone</option>
                                      <option value="sg">Singapore</option>
                                      <option value="sk">Slovakia</option>
                                      <option value="si">Slovenia</option>
                                      <option value="sb">Solomon Islands</option>
                                      <option value="so">Somalia</option>
                                      <option value="za">South Africa</option>
                                      <option value="gs">South Georgia and the South Sandwich Islands</option>
                                      <option value="kr">South Korea</option>
                                      <option value="es">Spain</option>
                                      <option value="lk">Sri Lanka</option>
                                      <option value="sd">Sudan</option>
                                      <option value="sr">Suriname</option>
                                      <option value="sj">Svalbard and Jan Mayen</option>
                                      <option value="sz">Swaziland</option>
                                      <option value="se">Sweden</option>
                                      <option value="ch">Switzerland</option>
                                      <option value="sy">Syria</option>
                                      <option value="tw">Taiwan</option>
                                      <option value="tj">Tajikistan</option>
                                      <option value="tz">Tanzania</option>
                                      <option value="th">Thailand</option>
                                      <option value="tl">Timor-Leste</option>
                                      <option value="tg">Togo</option>
                                      <option value="tk">Tokelau</option>
                                      <option value="to">Tonga</option>
                                      <option value="tt">Trinidad and Tobago</option>
                                      <option value="tn">Tunisia</option>
                                      <option value="tr">Turkey</option>
                                      <option value="tm">Turkmenistan</option>
                                      <option value="tc">Turks and Caicos Islands</option>
                                      <option value="tv">Tuvalu</option>
                                      <option value="ae">U.A.E.</option>
                                      <option value="vi">U.S. Virgin Islands</option>
                                      <option value="ug">Uganda</option>
                                      <option value="ua">Ukraine</option>
                                      <option value="gb">United Kingdom</option>
                                      <option value="um">United States Minor Outlying Islands</option>
                                      <option value="uy">Uruguay</option>
                                      <option value="uz">Uzbekistan</option>
                                      <option value="vu">Vanuatu</option>
                                      <option value="va">Vatican City</option>
                                      <option value="ve">Venezuela</option>
                                      <option value="vn">Vietnam</option>
                                      <option value="wf">Wallis and Futuna</option>
                                      <option value="eh">Western Sahara</option>
                                      <option value="ye">Yemen</option>
                                      <option value="zm">Zambia</option>
                                      <option value="zw">Zimbabwe</option>
                                      <option value="ax">Åland Islands</option>
                                      </select>
                                    </div>
                                  </div>
                                  <div class="inputs" ng-if="$root.isLoggedin">
                                    <div class="zipcode">
                                      <input type="text" class="form-control" id="zipcode-billing" ng-model="$parent.$parent.shipping_address.postal_code" placeholder="Zip Code" name="zipcode">
                                    </div>
                                    <div class="city">
                                      <input type="text" class="form-control" id="city-billing" ng-model="$parent.$parent.shipping_address.locality" placeholder="City" name="city">  
                                    </div>
                                    <div class="state">
                                      <select id="state_id-billing" data-value="shortcode" ng-model="$parent.$parent.shipping_address.region" name="state">
                                        <option value="">State</option>
                                      <option value="AK">AK</option>
                                        <option value="AL">AL</option>
                                        <option value="AS">AS</option>
                                        <option value="AZ">AZ</option>
                                        <option value="AR">AR</option>
                                        <option value="CA">CA</option>
                                        <option value="CO">CO</option>
                                        <option value="CT">CT</option>
                                        <option value="DE">DE</option>
                                        <option value="DC">DC</option>
                                        <option value="FM">FM</option>
                                        <option value="FL">FL</option>
                                        <option value="GA">GA</option>
                                        <option value="GU">GU</option>
                                        <option value="HI">HI</option>
                                        <option value="ID">ID</option>
                                        <option value="IL">IL</option>
                                        <option value="IN">IN</option>
                                        <option value="IA">IA</option>
                                        <option value="KS">KS</option>
                                        <option value="KY">KY</option>
                                        <option value="LA">LA</option>
                                        <option value="ME">ME</option>
                                        <option value="MH">MH</option>
                                        <option value="MD">MD</option>
                                        <option value="MA">MA</option>
                                        <option value="MI">MI</option>
                                        <option value="MN">MN</option>
                                        <option value="MS">MS</option>
                                        <option value="MO">MO</option>
                                        <option value="MT">MT</option>
                                        <option value="NE">NE</option>
                                        <option value="NV">NV</option>
                                        <option value="NH">NH</option>
                                        <option value="NJ">NJ</option>
                                        <option value="NM">NM</option>
                                        <option value="NY">NY</option>
                                        <option value="NC">NC</option>
                                        <option value="ND">ND</option>
                                        <option value="MP">MP</option>
                                        <option value="OH">OH</option>
                                        <option value="OK">OK</option>
                                        <option value="OR">OR</option>
                                        <option value="PW">PW</option>
                                        <option value="PA">PA</option>
                                        <option value="PR">PR</option>
                                        <option value="RI">RI</option>
                                        <option value="SC">SC</option>
                                        <option value="SD">SD</option>
                                        <option value="TN">TN</option>
                                        <option value="TX">TX</option>
                                        <option value="UT">UT</option>
                                        <option value="VT">VT</option>
                                        <option value="VI">VI</option>
                                        <option value="VA">VA</option>
                                        <option value="WA">WA</option>
                                        <option value="WV">WV</option>
                                        <option value="WI">WI</option>
                                        <option value="WY">WY</option>
                                      </select>
                                    </div>
                                  </div>
                                  <div ng-if="$root.isLoggedin">
                                    <button ladda="$parent.$parent.addShippingProcess" ng-disabled="$parent.processing" ng-click="confirmSave('shipping')">SAVE</button>
                                    <button ng-disabled="$parent.$parent.processing" ng-click="cancelAdd('shipping')">CANCEL</button>
                                  </div>
                                </div>
                                <hr>

                                <div class="pay_with_title">
                                Pay With
                                <div class="img-holder">
                                  <img src="<%= image_url "visa.png" %>">
                                  <img src="<%= image_url "mastercard.png" %>">
                                  <img src="<%= image_url "amex.png" %>">
                                  <img src="<%= image_url "discover.png" %>">
                                </div></div>
                                <div style="position:relative;">
                                  <div ng-if="edit_credit_card == 3" class="edit_credit_card mobile-margin">
                                    <div class="row">
                                      <div class="cc col-md-5 bottom-line">
                                        <input type="tel"  ng-model="$parent.card.last_digits" class="form-control" id="cc" placeholder="Credit Card Number" ng-change="checkCardNumber()" name="credit_card">
                                        <div class="img-holder">
                                          <img src="<%= image_url "visa.png" %>" ng-if="($parent.card.card_company | lowercase) == 'visa'">
                                          <img src="<%= image_url "mastercard.png" %>" ng-if="($parent.card.card_company | lowercase) == 'mastercard'">
                                          <img src="<%= image_url "amex.png" %>" ng-if="($parent.card.card_company | lowercase) == 'amex'">
                                          <img src="<%= image_url "discover.png" %>" ng-if="($parent.card.card_company | lowercase) == 'discover'">
                                        </div>
                                      </div>
                                      <div class="col-md-7">
                                        <div class="row">
                                          <div class="cvv col-xs-4 right-line">
                                            <select class="form-control" id="exp-month" ng-model="$parent.card.expiration_month" name="month">
                                              <option value="">Month</option>
                                              <option value="01">JAN</option>
                                              <option value="02">FEB</option>
                                              <option value="03">MAR</option>
                                              <option value="04">APR</option>
                                              <option value="05">MAY</option>
                                              <option value="06">JUN</option>
                                              <option value="07">JUL</option>
                                              <option value="08">AUG</option>
                                              <option value="09">SEP</option>
                                              <option value="10">OCT</option>
                                              <option value="11">NOV</option>
                                              <option value="12">DEC</option>
                                            </select>
                                          </div>
                                          <div class="exp-month col-xs-4 right-line">
                                            <select class="form-control" id="exp-year" ng-model="$parent.card.expiration_year" name="year">
                                              <option value="">Year</option>
                                              <option value="2016">2016</option>
                                              <option value="2017">2017</option>
                                              <option value="2018">2018</option>
                                              <option value="2019">2019</option>
                                              <option value="2020">2020</option>
                                              <option value="2021">2021</option>
                                              <option value="2022">2022</option>
                                              <option value="2023">2023</option>
                                              <option value="2024">2024</option>
                                              <option value="2025">2025</option>
                                              <option value="2026">2026</option>
                                              <option value="2027">2027</option>
                                              <option value="2028">2028</option>
                                              <option value="2029">2029</option>
                                              <option value="2030">2030</option>
                                              <option value="2031">2031</option>
                                              <option value="2032">2032</option>
                                              <option value="2033">2033</option>
                                              <option value="2034">2034</option>
                                              <option value="2035">2035</option>
                                              <option value="2036">2036</option>
                                              <option value="2037">2037</option>
                                              <option value="2038">2038</option>
                                              <option value="2039">2039</option>
                                            </select>
                                          </div>
                                                                <div class="col-xs-4 exp-year">
                                            <input type="tel" class="form-control" id="cvv" placeholder="CVV" ng-model="$parent.card.cvv" name="cvv"> 
                                          </div>
                                      </div>
                                      </div>
                                    </div>
                                    <div ng-if="$root.isLoggedin">
                                      <button ladda="$parent.addCardProcess" ng-disabled="$parent.$parent.processing" ng-click="confirmSave('card')">SAVE</button>
                                      <button ng-disabled="$parent.$parent.processing" ng-click="cancelAdd('card')">CANCEL</button>
                                    </div>
                                </div>
                                <div class="review" ng-if="edit_credit_card == 1">
                                    <span ng-if="cards.length">
                                      <div class="title">Credit Card</div>
                                      <div class="ccard vertical-center">
                                        <div class="img-holder">
                                          <img src="<%= image_url "visa.png" %>" ng-if="($parent.card.card_company | lowercase) == 'visa'">
                                          <img src="<%= image_url "mastercard.png" %>" ng-if="($parent.card.card_company | lowercase) == 'mastercard'">
                                          <img src="<%= image_url "amex.png" %>" ng-if="($parent.card.card_company | lowercase) == 'amex'">
                                          <img src="<%= image_url "discover.png" %>" ng-if="($parent.card.card_company | lowercase) == 'discover'">
                                        </div>
                                        ending in {{$parent.card.last_digits | limitTo:-4}}
                                      </div>
                                    </span>
                                    <span ng-if="!cards.length">
                                      <div class="title">No Credit Cards</div>
                                    </span>
                                    <button ng-disabled="$parent.processing" ng-click="toogleReview('card')">EDIT</button>
                                  </div>
                                  <div class="review" ng-if="edit_credit_card == 2">
                                    <span>
                                      <div class="ccard vertical-center" ng-repeat="c in cards">
                                        <input type="radio" ng-model="$parent.$parent.credit_card_index" value="{{$index}}">
                                        <div class="img-holder">
                                          <img src="<%= image_url "visa.png" %>" ng-if="(c.card_company | lowercase) == 'visa'">
                                          <img src="<%= image_url "mastercard.png" %>" ng-if="(c.card_company | lowercase) == 'mastercard'">
                                          <img src="<%= image_url "amex.png" %>" ng-if="(c.card_company | lowercase) == 'amex'">
                                          <img src="<%= image_url "discover.png" %>" ng-if="(c.card_company | lowercase) == 'discover'">
                                        </div>
                                        ending in {{c.last_digits | limitTo:-4}}
                                      </div>
                                      <span ng-if="!cards.length">
                                        <div class="title">No Credit Cards</div>
                                      </span>
                                    </span>
                                    <button ng-disabled="$parent.processing" ng-click="selectAddress('card')">DONE</button><button ng-disabled="$parent.processing" ng-click="addField('card')">ADD</button>
                                  </div>
                              </div>

                                <hr>

                                <div class="billing_title">Billing Address</div>
                            
                                <div class="review" ng-if="edit_billing == 2">
                                  <div ng-repeat="a in addresses" style="display:flex;">
                                    <input type="radio" ng-model="$parent.$parent.billing_address_index" value="{{$index}}">
                                    <div>
                                      <div class="title">{{a.name}}</div>
                                      <div>{{a.street_address}}<br>
                                      {{a.locality}}, {{a.region}} {{a.postal_code}}<br>
                                      {{a.country_code}}</div>
                                    </div>
                                  </div>
                                  <span ng-if="!addresses.length">
                                    <div class="title">No addresses</div>
                                  </span>
                                  <button ng-disabled="$parent.processing" ng-click="selectAddress('billing')">DONE</button><button ng-disabled="$parent.processing" ng-click="addField('billing')">ADD</button>
                                </div>
                                <div class="review" ng-if="edit_billing == 1">
                                  <span ng-if="addresses.length">
                                    <div class="title">{{billing_address.name}}</div>
                                    <span>
                                      <div>{{client.email}}</div>
                                    </span>
                                    <div>{{billing_address.street_address}}<br>
                                    {{billing_address.locality}}, {{billing_address.region}} {{billing_address.postal_code}}<br>
                                    {{billing_address.country_code}}</div>
                                  </span>
                                  <span ng-if="!addresses.length">
                                    <div class="title">No addresses</div>
                                  </span>
                                  <button ng-disabled="$parent.processing" ng-click="toogleReview('billing')">EDIT</button>
                                </div>
                                <div ng-if="edit_billing == 3" class="mobile-margin">
                                  <div class="inputs bottom-line">
                                    <div class="full-name">
                                      <input type="text" class="form-control" id="first-name-billing" ng-model="$parent.billing_address.name" placeholder="Name as it appears on card" name="name">
                                    </div>
                                  </div>
                                  <div class="inputs bottom-line">
                                    <div class="address">
                                      <input type="text" class="form-control" id="address-billing" ng-model="$parent.billing_address.street_address" placeholder="Address" name="address">
                                    </div>
                                  </div>
                                                
                                                <div class="inputs bottom-line">
                                                    <div class="address">
                                      <input type="text" class="form-control" id="city-billing" ng-model="$parent.billing_address.locality" placeholder="City" name="city"> 
                                    </div>
                                                </div>
                                                
                                  <div class="inputs bottom-line">
                                    <div class="country right-line">
                                      <select id="state_id-billing" data-value="shortcode" ng-model="$parent.billing_address.region" name="state">
                                        <option value="">State</option>
                                      <option value="AK">AK</option>
                                        <option value="AL">AL</option>
                                        <option value="AS">AS</option>
                                        <option value="AZ">AZ</option>
                                        <option value="AR">AR</option>
                                        <option value="CA">CA</option>
                                        <option value="CO">CO</option>
                                        <option value="CT">CT</option>
                                        <option value="DE">DE</option>
                                        <option value="DC">DC</option>
                                        <option value="FM">FM</option>
                                        <option value="FL">FL</option>
                                        <option value="GA">GA</option>
                                        <option value="GU">GU</option>
                                        <option value="HI">HI</option>
                                        <option value="ID">ID</option>
                                        <option value="IL">IL</option>
                                        <option value="IN">IN</option>
                                        <option value="IA">IA</option>
                                        <option value="KS">KS</option>
                                        <option value="KY">KY</option>
                                        <option value="LA">LA</option>
                                        <option value="ME">ME</option>
                                        <option value="MH">MH</option>
                                        <option value="MD">MD</option>
                                        <option value="MA">MA</option>
                                        <option value="MI">MI</option>
                                        <option value="MN">MN</option>
                                        <option value="MS">MS</option>
                                        <option value="MO">MO</option>
                                        <option value="MT">MT</option>
                                        <option value="NE">NE</option>
                                        <option value="NV">NV</option>
                                        <option value="NH">NH</option>
                                        <option value="NJ">NJ</option>
                                        <option value="NM">NM</option>
                                        <option value="NY">NY</option>
                                        <option value="NC">NC</option>
                                        <option value="ND">ND</option>
                                        <option value="MP">MP</option>
                                        <option value="OH">OH</option>
                                        <option value="OK">OK</option>
                                        <option value="OR">OR</option>
                                        <option value="PW">PW</option>
                                        <option value="PA">PA</option>
                                        <option value="PR">PR</option>
                                        <option value="RI">RI</option>
                                        <option value="SC">SC</option>
                                        <option value="SD">SD</option>
                                        <option value="TN">TN</option>
                                        <option value="TX">TX</option>
                                        <option value="UT">UT</option>
                                        <option value="VT">VT</option>
                                        <option value="VI">VI</option>
                                        <option value="VA">VA</option>
                                        <option value="WA">WA</option>
                                        <option value="WV">WV</option>
                                        <option value="WI">WI</option>
                                        <option value="WY">WY</option>
                                      </select>
                                    </div>
                                                    <div class="phone">
                                      <input type="text" class="form-control" id="zipcode-billing" ng-model="$parent.billing_address.postal_code" placeholder="Zip Code" name="zipcode">
                                    </div>
                                  </div>
                                                <div class="inputs">
                                                    <div class="country right-line">
                                      <select id="country-billing" ng-model="$parent.billing_address.country_code">
                                      <option value="">Select Country</option>
                                      <option value="us">United States</option>
                                      <option value="af">Afghanistan</option>
                                      <option value="al">Albania</option>
                                      <option value="dz">Algeria</option>
                                      <option value="as">American Samoa</option>
                                      <option value="ad">Andorra</option>
                                      <option value="ao">Angola</option>
                                      <option value="ai">Anguilla</option>
                                      <option value="aq">Antarctica</option>
                                      <option value="ag">Antigua and Barbuda</option>
                                      <option value="ar">Argentina</option>
                                      <option value="am">Armenia</option>
                                      <option value="aw">Aruba</option>
                                      <option value="au">Australia</option>
                                      <option value="at">Austria</option>
                                      <option value="az">Azerbaijan</option>
                                      <option value="bs">Bahamas</option>
                                      <option value="bh">Bahrain</option>
                                      <option value="bd">Bangladesh</option>
                                      <option value="bb">Barbados</option>
                                      <option value="by">Belarus</option>
                                      <option value="be">Belgium</option>
                                      <option value="bz">Belize</option>
                                      <option value="bj">Benin</option>
                                      <option value="bm">Bermuda</option>
                                      <option value="bt">Bhutan</option>
                                      <option value="bo">Bolivia</option>
                                      <option value="ba">Bosnia and Herzegovina</option>
                                      <option value="bw">Botswana</option>
                                      <option value="bv">Bouvet Island</option>
                                      <option value="br">Brazil</option>
                                      <option value="io">British Indian Ocean Territory</option>
                                      <option value="vg">British Virgin Islands</option>
                                      <option value="bn">Brunei Darussalam</option>
                                      <option value="bg">Bulgaria</option>
                                      <option value="bf">Burkina Faso</option>
                                      <option value="bi">Burundi</option>
                                      <option value="kh">Cambodia</option>
                                      <option value="cm">Cameroon</option>
                                      <option value="ca">Canada</option>
                                      <option value="cv">Cape Verde</option>
                                      <option value="ky">Cayman Islands</option>
                                      <option value="cf">Central African Republic</option>
                                      <option value="td">Chad</option>
                                      <option value="cl">Chile</option>
                                      <option value="cn">China</option>
                                      <option value="cx">Christmas Island</option>
                                      <option value="cc">Cocos (Keeling) Islands</option>
                                      <option value="co">Colombia</option>
                                      <option value="km">Comoros</option>
                                      <option value="cg">Congo-Brazzaville</option>
                                      <option value="cd">Congo-Kinshasa</option>
                                      <option value="ck">Cook Islands</option>
                                      <option value="cr">Costa Rica</option>
                                      <option value="hr">Croatia</option>
                                      <option value="cu">Cuba</option>
                                      <option value="cy">Cyprus</option>
                                      <option value="cz">Czech Republic</option>
                                      <option value="dk">Denmark</option>
                                      <option value="dj">Djibouti</option>
                                      <option value="dm">Dominica</option>
                                      <option value="do">Dominican Republic</option>
                                      <option value="ec">Ecuador</option>
                                      <option value="eg">Egypt</option>
                                      <option value="sv">El Salvador</option>
                                      <option value="gq">Equatorial Guinea</option>
                                      <option value="er">Eritrea</option>
                                      <option value="ee">Estonia</option>
                                      <option value="et">Ethiopia</option>
                                      <option value="fk">Falkland Islands (Malvinas)</option>
                                      <option value="fo">Faroe Islands</option>
                                      <option value="fj">Fiji</option>
                                      <option value="fi">Finland</option>
                                      <option value="fr">France</option>
                                      <option value="gf">French Guiana</option>
                                      <option value="pf">French Polynesia</option>
                                      <option value="tf">French Southern Territories</option>
                                      <option value="ga">Gabon</option>
                                      <option value="gm">Gambia</option>
                                      <option value="ge">Georgia</option>
                                      <option value="de">Germany</option>
                                      <option value="gh">Ghana</option>
                                      <option value="gi">Gibraltar</option>
                                      <option value="gr">Greece</option>
                                      <option value="gl">Greenland</option>
                                      <option value="gd">Grenada</option>
                                      <option value="gp">Guadeloupe</option>
                                      <option value="gu">Guam</option>
                                      <option value="gt">Guatemala</option>
                                      <option value="gg">Guernsey</option>
                                      <option value="gn">Guinea</option>
                                      <option value="gw">Guinea-Bissau</option>
                                      <option value="gy">Guyana</option>
                                      <option value="ht">Haiti</option>
                                      <option value="hm">Heard Island and McDonald Islands</option>
                                      <option value="hn">Honduras</option>
                                      <option value="hk">Hong Kong</option>
                                      <option value="hu">Hungary</option>
                                      <option value="is">Iceland</option>
                                      <option value="in">India</option>
                                      <option value="id">Indonesia</option>
                                      <option value="ir">Iran</option>
                                      <option value="iq">Iraq</option>
                                      <option value="ie">Ireland</option>
                                      <option value="im">Isle of Man</option>
                                      <option value="il">Israel</option>
                                      <option value="it">Italy</option>
                                      <option value="ci">Ivory Coast</option>
                                      <option value="jm">Jamaica</option>
                                      <option value="jp">Japan</option>
                                      <option value="je">Jersey</option>
                                      <option value="jo">Jordan</option>
                                      <option value="kz">Kazakhstan</option>
                                      <option value="ke">Kenya</option>
                                      <option value="ki">Kiribati</option>
                                      <option value="kw">Kuwait</option>
                                      <option value="kg">Kyrgyzstan</option>
                                      <option value="la">Laos</option>
                                      <option value="lv">Latvia</option>
                                      <option value="lb">Lebanon</option>
                                      <option value="ls">Lesotho</option>
                                      <option value="lr">Liberia</option>
                                      <option value="ly">Libya</option>
                                      <option value="li">Liechtenstein</option>
                                      <option value="lt">Lithuania</option>
                                      <option value="lu">Luxembourg</option>
                                      <option value="mo">Macao</option>
                                      <option value="mk">Macedonia, F.Y.R. of</option>
                                      <option value="mg">Madagascar</option>
                                      <option value="mw">Malawi</option>
                                      <option value="my">Malaysia</option>
                                      <option value="mv">Maldives</option>
                                      <option value="ml">Mali</option>
                                      <option value="mt">Malta</option>
                                      <option value="mh">Marshall Islands</option>
                                      <option value="mq">Martinique</option>
                                      <option value="mr">Mauritania</option>
                                      <option value="mu">Mauritius</option>
                                      <option value="yt">Mayotte</option>
                                      <option value="mx">Mexico</option>
                                      <option value="fm">Micronesia</option>
                                      <option value="md">Moldova</option>
                                      <option value="mc">Monaco</option>
                                      <option value="mn">Mongolia</option>
                                      <option value="me">Montenegro</option>
                                      <option value="ms">Montserrat</option>
                                      <option value="ma">Morocco</option>
                                      <option value="mz">Mozambique</option>
                                      <option value="mm">Myanmar</option>
                                      <option value="na">Namibia</option>
                                      <option value="nr">Nauru</option>
                                      <option value="np">Nepal</option>
                                      <option value="nl">Netherlands</option>
                                      <option value="an">Netherlands Antilles</option>
                                      <option value="nc">New Caledonia</option>
                                      <option value="nz">New Zealand</option>
                                      <option value="ni">Nicaragua</option>
                                      <option value="ne">Niger</option>
                                      <option value="ng">Nigeria</option>
                                      <option value="nu">Niue</option>
                                      <option value="nf">Norfolk Island</option>
                                      <option value="kp">North Korea</option>
                                      <option value="mp">Northern Mariana Islands</option>
                                      <option value="no">Norway</option>
                                      <option value="ps">Occupied Palestinian Territory</option>
                                      <option value="om">Oman</option>
                                      <option value="pk">Pakistan</option>
                                      <option value="pw">Palau</option>
                                      <option value="pa">Panama</option>
                                      <option value="pg">Papua New Guinea</option>
                                      <option value="py">Paraguay</option>
                                      <option value="pe">Peru</option>
                                      <option value="ph">Philippines</option>
                                      <option value="pn">Pitcairn</option>
                                      <option value="pl">Poland</option>
                                      <option value="pt">Portugal</option>
                                      <option value="pr">Puerto Rico</option>
                                      <option value="qa">Qatar</option>
                                      <option value="re">Reunion</option>
                                      <option value="ro">Romania</option>
                                      <option value="ru">Russian Federation</option>
                                      <option value="rw">Rwanda</option>
                                      <option value="bl">Saint Barthélemy</option>
                                      <option value="sh">Saint Helena</option>
                                      <option value="kn">Saint Kitts and Nevis</option>
                                      <option value="lc">Saint Lucia</option>
                                      <option value="mf">Saint Martin</option>
                                      <option value="pm">Saint Pierre and Miquelon</option>
                                      <option value="vc">Saint Vincent and the Grenadines</option>
                                      <option value="ws">Samoa</option>
                                      <option value="sm">San Marino</option>
                                      <option value="st">Sao Tome and Principe</option>
                                      <option value="sa">Saudi Arabia</option>
                                      <option value="sn">Senegal</option>
                                      <option value="rs">Serbia</option>
                                      <option value="sc">Seychelles</option>
                                      <option value="sl">Sierra Leone</option>
                                      <option value="sg">Singapore</option>
                                      <option value="sk">Slovakia</option>
                                      <option value="si">Slovenia</option>
                                      <option value="sb">Solomon Islands</option>
                                      <option value="so">Somalia</option>
                                      <option value="za">South Africa</option>
                                      <option value="gs">South Georgia and the South Sandwich Islands</option>
                                      <option value="kr">South Korea</option>
                                      <option value="es">Spain</option>
                                      <option value="lk">Sri Lanka</option>
                                      <option value="sd">Sudan</option>
                                      <option value="sr">Suriname</option>
                                      <option value="sj">Svalbard and Jan Mayen</option>
                                      <option value="sz">Swaziland</option>
                                      <option value="se">Sweden</option>
                                      <option value="ch">Switzerland</option>
                                      <option value="sy">Syria</option>
                                      <option value="tw">Taiwan</option>
                                      <option value="tj">Tajikistan</option>
                                      <option value="tz">Tanzania</option>
                                      <option value="th">Thailand</option>
                                      <option value="tl">Timor-Leste</option>
                                      <option value="tg">Togo</option>
                                      <option value="tk">Tokelau</option>
                                      <option value="to">Tonga</option>
                                      <option value="tt">Trinidad and Tobago</option>
                                      <option value="tn">Tunisia</option>
                                      <option value="tr">Turkey</option>
                                      <option value="tm">Turkmenistan</option>
                                      <option value="tc">Turks and Caicos Islands</option>
                                      <option value="tv">Tuvalu</option>
                                      <option value="ae">U.A.E.</option>
                                      <option value="vi">U.S. Virgin Islands</option>
                                      <option value="ug">Uganda</option>
                                      <option value="ua">Ukraine</option>
                                      <option value="gb">United Kingdom</option>
                                      <option value="um">United States Minor Outlying Islands</option>
                                      <option value="uy">Uruguay</option>
                                      <option value="uz">Uzbekistan</option>
                                      <option value="vu">Vanuatu</option>
                                      <option value="va">Vatican City</option>
                                      <option value="ve">Venezuela</option>
                                      <option value="vn">Vietnam</option>
                                      <option value="wf">Wallis and Futuna</option>
                                      <option value="eh">Western Sahara</option>
                                      <option value="ye">Yemen</option>
                                      <option value="zm">Zambia</option>
                                      <option value="zw">Zimbabwe</option>
                                      <option value="ax">Åland Islands</option>
                                      </select>
                                    </div>
                                                    <div class="phone">
                                      <input type="tel" class="form-control numeric" id="phone-billing" ng-model="$parent.client.primary_phone_number.number" placeholder="Phone Number" name="phone_number">
                                    </div>
                                                </div>
                                                
                                                
                                  <div ng-if="$root.isLoggedin">
                                    <button ladda="$parent.$parent.addBillingProcess" ng-disabled="$parent.processing" ng-click="confirmSave('billing')">SAVE</button>
                                    <button ng-disabled="$parent.$parent.processing" ng-click="cancelAdd('billing')">CANCEL</button>
                                  </div>
                                </div>
                                <hr class="hidden-xs hidden-sm hidden">
                                <div class="badge-container">
                                  <!--div class="ggg-badge-pledge pledge-left">
                                    <div class="badge-left-element">
                                      <img src="<%= image_url "badge-gamehedge.png" %>" class="ggg-img">
                                    </div>
                                    <div class="badge-right-element">
                                      <div class="title">
                                        YOUR TICKETS COME WITH THE GOOD GAME GUARANTEE! 
                                      </div>
                                      <div class="cont">
                                        If the home team loses by {{event.home_performer.sport.ggg}} or more, GameHedge will refund 50% of your ticket price at no additional cost to you.
                                      </div>
                                    </div>
                                  </div-->
                                  <!-- <div class="ggg-badge-pledge pledge-right">
                                    <div class="badge-left-element left-custom">
                                      <img src="<%= image_url "pledge.png" %>" class="pledge-img">
                                    </div>
                                    <div class="badge-right-element right-custom">
                                      <div class="title-1">
                                        GAMEHEDE PLEDGE
                                      </div>
                                                        <div class="sub-cont">
                                                            Tickets will always be…
                                                        </div>
                                      <div class="cont">
                                        <ul>
                                          <li>In time for the event</li>
                                          <li>Refunded if the event is canceled &amp; not resecheduled</li>
                                          <li>Authentic</li>
                                        </ul>
                                      </div>
                                    </div>
                                  </div> -->
                                                <div class="ggg-left">
                                                    <div class="ggg-text">If the home team loses by {{event.home_performer.sport.ggg}} or more, <span class="ggg-bold"><strong>GameHedge will refund 50% of your ticket price</strong></span> at no additional cost to you.</div>
                                                    <div><img src="<%= image_url "ggg.jpg" %>"></div>
                                                </div>
                                                <div class="ggg-right">
                                                    <img src="<%= image_url "pledge_new.png" %>">
                                                </div>
                                  
                                </div>
                              </div>
                            </div>
                          </div>
                          <div class="col-md-4 mobile-separator card-element second-card">
                            <div class="card">
                              <div class="card-in summary">
                                <div class="title hidden-md hidden-lg hidden-xl">Order Summary</div>
                                <span class="hidden-xs hidden-sm">
                                  <div class="title">{{ticket.event.name}}</div>
                                                <div class="info" style="height:10px;"> </div>
                                  <div class="info">
                                    {{event.occurs_at | date: "EEE, MMM dd, yyyy hh:mm a" : 'UTC'}}<br>
                                    {{event.venue.name}}, {{event.venue.location}}<br>
                                                    <div class="info" style="height:10px;"> </div>
                                    <span class="title" style="line-height: 1em;">Section {{ticket.section}}, Row {{ticket.row}}</span>
                                  </div>
                                                <div class="info" style="height:10px;"> </div>
                              </span>
                                <hr>
                                <div class="description-line">
                                  <div class="description">Ticket Price</div>
                                  <div class="value">{{ticket.retail_price | currency}} ea.</div>
                                </div>
                                <div class="description-line">
                                  <div class="description">Quantity</div>
                                  <div class="value" >
                                    <select class="amount select-mobile" id="amount" ng-model="amount" ng-change="calculateValues()" >
                                      <option ng-repeat="o in ticket.splits | orderBy:'-'" value="{{o}}">{{o}}</option>
                                    </select>
                                  </div>
                                </div>
                                <div class="description-line">
                                  <div class="description">Subtotal</div>
                                  <div class="value">{{subtotal | currency}}</div>
                                </div>
                                            <hr>
                                            <div class="description-line">
                                  <div class="description short">Service Fee</div>
                                  <div class="value short">{{service_fee | currency}}</div>
                                </div>
                                            <div class="description-line" ng-show="ticket.format == 'Physical'">
                                  <div class="description">Delivery Option</div>
                                  <div class="value" >
                                    <select id="shipping" class="select-mobile" ng-model="shipping_fee" ng-change="calculateValues()" >
                                      <option ng-repeat="o in shipping_list | limitTo:2" value="{{o.price}}">{{o.name}}</option>
                                    </select>
                                  </div>
                                </div>
                                <div class="description-line" ng-show="ticket.format == 'Physical'">
                                  <div class="description short">Shipping Fee</div>
                                  <div class="value short">{{shipping_fee | currency}}</div>
                                </div>
                                <div class="description-line">
                                  <div class="description short">Shipping</div>
                                  <div class="value short" ng-if="ticket.format == 'Physical'">Physical Delivery</div>
                                  <div class="value short" ng-if="ticket.format == 'Eticket'">Email Delivery</div>
                                  <div class="value short" ng-if="ticket.format != 'Eticket' && ticket.format != 'Physical'">{{ticket.format | replaceText}}</div>
                                </div>
                                <div class="description-line">
                                  <div class="description short">Good Game Guarantee</div>
                                  <div class="value short">FREE</div>
                                </div>
                                <div class="description-line" ng-if="active_promos">
                                  <div class="description promo-btn" ng-click="showPromoField()">Promo Code</div>
                                  <div class="value">
                                    <input ng-show="show_promo_field" id="promo" ng-model="$parent.promo_code" ng-change="calculateValues()" name="promo_code" style="border: solid 1px #d3d3d3;">
                                  </div>
                                </div>
                                <div class="description-line" ng-show="discount != 0">
                                  <div class="description">Discount</div>
                                  <div class="value">-{{discount | currency}}</div>
                                </div>
                                <hr>
                                <div class="description-line total">
                                  <div class="description">TOTAL</div>
                                  <div class="value">{{total | currency}}</div>
                                </div>
                                <button class="confirm_pay" ladda="payProcess" ng-disabled="processing || editing" ng-click="confirmPay()">Confirm and Pay</button>
                                <div class="terms">By clicking Confirm and Pay, you agree to GameHedge <a href="/our-terms" target="_blank">Terms and Privacy Policy.</a> The link between our servers and your browser is protected using SSL encryption</div>
                                            
                                            <div class="seals">
                                                <div class="row">
                                                    <div class="col-xs-4 text-left">
                                                        <span id="siteseal">
                                                            <script async type="text/javascript" src="https://seal.godaddy.com/getSeal?sealID=qGUZ4cVXP8fzh4gJM9WNOM8Lhm3GV8MAOuZcgI4ynEm7EcjgKcT8zguOJYzw"></script>
                                                        </span>
                                                    </div>
                                                    <div class="col-xs-4 text-center">
                                                        <div bind-unsafe-html='script' id="mcafeeseal"></div>
                                                    </div>
                                                    <div class="col-xs-4 text-right">
                                                        <a href="https://www.braintreegateway.com/merchants/5n2r8dvdp2mmbtw7/verified" target="_blank">
                                                            <img src="https://s3.amazonaws.com/braintree-badges/braintree-badge-dark.png" width="82px" height ="22px" border="0"/>
                                                        </a>
                                                    </div>
                                                </div>
                                                
                                            </div>
                                            
                                <div id="session_iframe" ng-bind-html="session_iframe"></div>
                              </div>
                                    
                            </div>
                          </div>
                        </div>
                      </div>
                  </section>
                </span>




                <!-- Modal -->
                <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
                  <div class="modal-dialog" role="document">
                    <div class="modal-content">
                      <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="myModalLabel">You already have an account with us. Please Login.</h4>
                      </div>
                      <div id="confirmation">
                        <div class="modal-body">

                       
                      <div class="row update-password" ng-if="!forgot_password">
                        <div class="col-xs-12">
                          <input type="email" name="email" placeholder="Email" ng-model="$parent.client.email">
                        </div>
                        <div class="col-xs-12">
                          <input type="password" name="password" placeholder="Password" ng-model="$parent.password">
                        </div>
                        <div class="col-xs-12">
                          <button ng-click="login()" ladda="logging_in">Login</button>
                        </div>
                        <div class="forgot" ng-click="forgotPass(true)">Forgot password?</div>
                      </div>


                      <div class="row update-password" ng-if="forgot_password">
                        <div class="col-xs-12">
                          <input type="email" name="email" placeholder="Email" ng-model="$parent.client.email">
                        </div>
                        <div class="col-xs-12">
                          <button ng-click="updatePasswordAuth()" ladda="sending_password">Send Password</button>
                        </div>
                        <div class="forgot" ng-click="forgotPass(false)">Login</div>
                      </div>
                    </div>
                    </div>
                    </div>
                  </div>
                </div>


            </div>
        </div>




       
        <div growl></div>
    </div>
</span>

<%= stylesheet_link_tag 'ladda-themeless.min', 'data-turbolinks-track' => true %>
<%= javascript_include_tag 'angular.min', 'data-turbolinks-track' => true %>
<%= javascript_include_tag 'jquery.tuMap-min', 'data-turbolinks-track' => true %>
<%= javascript_include_tag 'angular-animate.min', 'data-turbolinks-track' => true %>
<%= javascript_include_tag 'spin.min', 'data-turbolinks-track' => true %>
<%= javascript_include_tag 'ladda.min', 'data-turbolinks-track' => true %>
<%= javascript_include_tag 'angular-ladda.min', 'data-turbolinks-track' => true %>
<%= javascript_include_tag 'devise', 'data-turbolinks-track' => true %>
<%= javascript_include_tag '401', 'data-turbolinks-track' => true %>
<%= javascript_include_tag 'auth', 'data-turbolinks-track' => true %>

        
<script>
    app = angular.module('gamehedge',[
        'Devise',
        'angular-ladda',
    ])

    app.service('apiService', function($http) {
    
        this.getData = function( url ) {
            var request = $http({
                method: "get",
                url: url,
                params: {
                    action: "get"
                },
                headers: {
                   'Authorization': 'Token token="TokenHere"'
                },
            });
            return( request.then( handleSuccess, handleError ) );
        }
        
        this.postData = function(url, params) {
            var request = $http({
                method: "POST",
                url: url,
                data: params,
                headers: {
                   'Authorization': 'Token token="TokenHere"'
                },
            });
            return( request.then( handleSuccess, handleError ) );
        }

        this.putData = function(url, params) {
            var request = $http({
                method: "PUT",
                url: url,
                data: params,
                headers: {
                   'Authorization': 'Token token="TokenHere"'
                },
            });
            return( request.then( handleSuccess, handleError ) );
        }

        this.patchData = function(url, params) {
            var request = $http({
                method: "PATCH",
                url: url,
                data: params,
                headers: {
                   'Authorization': 'Token token="TokenHere"'
                },
            });
            return( request.then( handleSuccess, handleError ) );
        }

        this.deleteData = function(url, params) {
            var request = $http({
                method: "DELETE",
                url: url,
                headers: {
                   'Authorization': 'Token token="TokenHere"'
                },
            });
            return( request.then( handleSuccess, handleError ) );
        }

        
        function handleError( response ) {
            // The API response from the server should be returned in a
            // nomralized format. However, if the request was not handled by the
            // server (or what not handles properly - ex. server error), then we
            // may have to normalize it on our end, as best we can.
            if (
                ! angular.isObject( response.data ) ||
                ! response.data.message
                ) {
                return("An unknown error occurred.");
            }
            // Otherwise, use expected error message.
            return(response.data.message);
        }
        // I transform the successful response, unwrapping the application data
        // from the API response payload.
        function handleSuccess( response ) {
            return( response.data );
        }
    })
    app.service('dataService', function($http) {
        
        this.getData = function( url ) {
            var request = $http({
                method: "get",
                url: url,
                params: {
                    action: "get"
                }
            });
            return( request.then( handleSuccess, handleError ) );
        }
        
        this.postData = function(url, params) {
            var request = $http({
                method: "POST",
                url: url,
                data: params
            });
            return( request.then( handleSuccess, handleError ) );
        }
        
        function handleError( response ) {
            // The API response from the server should be returned in a
            // nomralized format. However, if the request was not handled by the
            // server (or what not handles properly - ex. server error), then we
            // may have to normalize it on our end, as best we can.
            if (
                ! angular.isObject( response.data ) ||
                ! response.data.message
                ) {
                return( $q.reject( "An unknown error occurred." ) );
            }
            // Otherwise, use expected error message.
            return( $q.reject( response.data.message ) );
        }
        // I transform the successful response, unwrapping the application data
        // from the API response payload.
        function handleSuccess( response ) {
            return( response );
        }
    })
    app.controller('OrderController', function($scope,$rootScope,$http,Auth,$location,$timeout,apiService,$filter,$window,Analytics){
    
      setInterval(function() {
          if ($(window).width() > 992){
              if($(".badge-container").offset().top > 0){
                  if($(".confirm_pay").offset().top > $(".badge-container").offset().top){
                      var diff = $(".confirm_pay").offset().top - $(".badge-container").offset().top;
                      $(".badge-container").css("padding-top", diff + "px");
                  }
              }   
          }
      }, 100); 
      
      $rootScope.showHeader = true;
      $scope.getTicket = function(){
      $http({
              method: 'GET',
              url: '/tickets/show?id='+<%= params[:id] %>,
          }).then(function successCallback(response) {
            $scope.ticket = response.data;
            //console.log("Ticket")
            //console.log($scope.ticket);
            apiService.getData('/api/v1/events/'+$scope.ticket.event.id)
                .then(function(response){
                  // console.log("Event");
                  // console.log(response);
                    $scope.event = response;
                    $rootScope.title = "Order | Gamehedge";
            $rootScope.description = "Buy and Save up to 60% on all game tickets. If the home team losses by "+$scope.event.home_performer.sport.ggg+" or more, get 50% of your ticket price back.";
                    $scope.amount = $location.search()['amount'];
                    $scope.calculateValues();
            });
            if($scope.ticket.format == "Physical"){
            $scope.shipping_fee = "25.0";
          }
          else{
            $scope.shipping_fee = 0;
          }
          $scope.ticketsLoaded = true;
          }, function errorCallback(response) {
              //console.log(response);
          });
      }

      $scope.checkEmail =function(){
        var re = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
        if(re.test($scope.client.email) == true){
          $http({
                  method: 'POST',
                  url: '/clients/exists',
                  data: {
                    email: $scope.client.email,
                  },
              }).then(function successCallback(response) {
                //console.log(response.data)
                if(response.data == "true"){
                  $('#myModal').modal('show');
                }
              });
        }
      }

      $scope.getPromoCodes = function(){
        apiService.getData('/api/v1/promo_codes/')
                .then(function(response){
                    //console.log("Promo Codes");
                  //console.log(response);
                    $scope.promo_codes = response;
                    var today = new Date()
                    today.setHours(today.getHours()-(today.getTimezoneOffset()/60));
                    today = today.toISOString();
                    today = today.split('T')[0] + "T00:00:00.000Z";
                    for(i=0;i<$scope.promo_codes.length;i++){
                      var date_1 = new Date($scope.promo_codes[i].start_date).toISOString();
                      var date_2 = new Date($scope.promo_codes[i].end_date).toISOString();
                      today = new Date(today);
                      date_1 = new Date(date_1);
                      date_2 = new Date(date_2);
                      if($scope.promo_codes[i].active == true && today >= date_1 && today <= date_2){
                        $scope.active_promos = true;
                        break;
                      }
                    }
                    $scope.getServiceFees();
            });
      }

      $scope.getServiceFees= function(){
        apiService.getData('/api/v1/service_fees/')
                .then(function(response){
                    $scope.service_fees = response
                    angular.forEach($scope.service_fees, function (fee) {
                fee.minimum_amount = Number(fee.minimum_amount);
              });
                  $scope.service_fees = $filter('orderBy')($scope.service_fees,'minimum_amount');
                  //console.log("Service Fees");
                  //console.log($scope.service_fees);
                  $scope.getTicket();
            });
      }

      $scope.checkCardNumber = function(){
        $scope.card.card_company = $.payment.cardType($scope.card.last_digits);
      }

      $scope.calculateValues = function(){
        if($scope.ticket && $scope.amount){
          $scope.subtotal = (Number($scope.ticket.retail_price) * Number($scope.amount));
        }
        if(typeof $scope.service_fees != "undefined" && $scope.service_fees.length != 0){
          for(i=0;i<$scope.service_fees.length;i++){
            if(i+1 == $scope.service_fees.length){
              $scope.service_fee = Number($scope.service_fees[i].fee_amount)*$scope.subtotal/100;
              break;
            }
            else if($scope.subtotal > $scope.service_fees[i].minimum_amount && $scope.subtotal <= $scope.service_fees[i+1].minimum_amount){
              $scope.service_fee = Number($scope.service_fees[i].fee_amount)*$scope.subtotal/100;
              break;
            }
          }
        }
        else{
          $scope.service_fee = 0;
        }
        for(i=0;i<$scope.promo_codes.length;i++){
          // console.log($scope.promo_codes[i].code);
          // console.log($scope.promo_code);
          if($scope.promo_code == $scope.promo_codes[i].code){
            if($scope.promo_codes[i].is_percentage == true){
              $scope.discount = ($scope.subtotal + $scope.service_fee)*Number($scope.promo_codes[i].value)/100;
            }
            else{
              $scope.discount = Number($scope.promo_codes[i].value);
            }
            break;
          }
          else{
            $scope.discount = 0;
          }
        }
        if(typeof $scope.service_fees != "undefined"){
          if($scope.ticket.format == "Physical"){
            $scope.total = $scope.subtotal + $scope.service_fee + Number($scope.shipping_fee) - $scope.discount;
          }
          else{
            $scope.total = Number($scope.subtotal) + Number($scope.service_fee) - $scope.discount;
          }
        }
      }

      $scope.selectAddress = function(type){
        if(type == "shipping"){
          $scope.shipping_address = $scope.addresses[$scope.shipping_address_index];
          $scope.changed_shipping_address = true;
          $scope.edit_deliver = 1;
        }
        else if(type == "billing"){
          $scope.billing_address = $scope.addresses[$scope.billing_address_index];
          $scope.changed_billing_address = true;
          $scope.edit_billing = 1;
        }
        if(type == "card"){
          $scope.card = $scope.cards[$scope.credit_card_index];
          $scope.changed_credit_card = true;
          $scope.edit_credit_card = 1;
        }
        $scope.editing = false;
      }

      $scope.toogleReview = function(toogle){
        $scope.editing = true;
        if(toogle == "card"){
          if($rootScope.isLoggedin == false){
            $scope.edit_credit_card = 3;
          }
          else{
            $scope.edit_credit_card = 2;
          }
        }
        else if(toogle == "billing"){
          if($rootScope.isLoggedin == false){
            $scope.edit_billing = 3;
          }
          else{
            $scope.edit_billing = 2;
          }
        }
        else if(toogle == "deliver"){
          if($rootScope.isLoggedin == false){
            $scope.edit_deliver = 3;
          }
          else{
            $scope.edit_deliver = 2;
          }
        }
        $scope.creditCardFieldEnable();
      }
      $scope.creditCardFieldEnable = function(){
        $timeout(function(){
          $('input#cc').payment('formatCardNumber');
          $('input#cvv').payment('formatCardCVC');
          $('input.numeric').payment('restrictNumeric');
        },100);
      }

      $scope.addField = function(type){
        if(type == "shipping"){
          $scope.edit_deliver = 3;
          $scope.shipping_address = {};
          $scope.shipping_address.country_code = "";
          $scope.shipping_address.id = "";
          $scope.shipping_address.locality = "";
          $scope.shipping_address.name = "";
          $scope.shipping_address.postal_code = "";
          $scope.shipping_address.region = "";
          $scope.shipping_address.street_address = "";
        }
        else if(type == "card"){
          $scope.edit_credit_card = 3;
          $scope.card.cvv = ""
          $scope.card.expiration_month = ""
          $scope.card.expiration_year = ""
          $scope.card.last_digits = ""
          $scope.card.card_company = ""
          $scope.creditCardFieldEnable();
        }
        else if(type == "billing"){
          $scope.edit_billing = 3;
          $scope.billing_address = {};
          $scope.billing_address.country_code = "";
          $scope.billing_address.id = "";
          $scope.billing_address.locality = "";
          $scope.billing_address.name = "";
          $scope.billing_address.postal_code = "";
          $scope.billing_address.region = "";
          $scope.billing_address.street_address = "";
        }
      }

      $scope.cancelAdd = function(type){
        if(type == "shipping"){
          $scope.edit_deliver = 1;
          if($scope.changed_shipping_address == true){
            $scope.shipping_address = $scope.addresses[$scope.shipping_address_index];
          }
          else{
            $scope.shipping_address = $scope.client.primary_shipping_address;
          }
        }
        else if(type == "card"){
          $scope.edit_credit_card = 1;
          if($scope.changed_credit_card == true){
            $scope.card = $scope.cards[$scope.credit_card_index];
          }
          else{
            $scope.card = $scope.client.primary_credit_card;
          }
        }
        else if(type == "billing"){
          $scope.edit_billing = 1;
          if($scope.changed_billing_address == true){
            $scope.billing_address = $scope.addresses[$scope.billing_address_index];
          }
          else{
            $scope.billing_address = $scope.client.primary_billing_address;
          }
        }
        $scope.editing = false;
      }

      $scope.createCard = function(){
        $http({
              method: 'POST',
              url: '/clients/add_credit_card',
              data: { 
                id: $scope.client.id,
                address_id: $scope.billing_address.id,
                number: $scope.card.last_digits,
                expiration_month: $scope.card.expiration_month,
                expiration_year: $scope.card.expiration_year,
                verification_code: $scope.card.cvv,
                name: $scope.client.name,
              },
          }).then(function successCallback(response) {
            if(response.data.error != undefined){
              $scope.processing = false;
              $scope.payProcess = false;
              $scope.edit_deliver = 1;
            $scope.edit_billing = 1;
            $scope.edit_credit_card = 3;
            swal("Error", response.data.error, "error");
            }
            else{
              $scope.card = response.data;
              $scope.cards.push($scope.card);
              $scope.credit_card_index = 0;
              //console.log($scope.card);
              $scope.confirmPay();
            }
          }, function errorCallback(response) {
            //console.log(response);
            scope.processing = false;
          $scope.payProcess = false;
            $scope.edit_credit_card = 3;
            $scope.edit_billing = 1;
            $scope.edit_deliver = 1;
          });
      }
        
      $scope.goToConfirm = function(){
        // $rootScope.orderId = $scope.order.id;
        $rootScope.orderId = 873465873465;
        window.location.href = '/confirm/'+String($scope.order.id)+'?new_client='+$scope.first_time;
      }

      $scope.confirmSave = function(type){
        $scope.processing = true;
        $scope.editing = false;
        if(type == "shipping"){
          $scope.addShippingProcess = true;
          if($scope.shipping_address.name != "" && $scope.shipping_address.street_address != "" && $scope.shipping_address.locality != "" && $scope.shipping_address.region != "" && $scope.shipping_address.postal_code != "" && $scope.shipping_address.country_code != ""){
            $http({
                  method: 'POST',
                  url: '/clients/add_address',
                  data: { 
                    id: $scope.client.id,
                    name: $scope.shipping_address.name,
                    street_address: $scope.shipping_address.street_address,
                    locality: $scope.shipping_address.locality,
                    region: $scope.shipping_address.region,
                    postal_code: $scope.shipping_address.postal_code,
                    country_code: $scope.shipping_address.country_code,
                  },
              }).then(function successCallback(response) {
                $scope.shipping_address = response.data;
                $scope.addresses.push($scope.shipping_address);
                $scope.shipping_address_index = $scope.addresses.length - 1;
                //console.log($scope.shipping_address);
                $scope.edit_deliver = 1;
                $scope.processing = false;
                $scope.addShippingProcess = false;
              }, function errorCallback(response) {
                //console.log(response);
                $scope.processing = false;
                $scope.addShippingProcess = false;
              });
          }
          else{
            $scope.addShippingProcess = false;
            $scope.processing = false;
            swal("Error", "All fields are required", "warning");
          }
        }
        else if(type == "card"){
          $scope.addCardProcess = true;
          if($scope.card.cvv != "" && $scope.card.expiration_month != "" && $scope.card.expiration_year != "" && $scope.card.last_digits != "" && $.payment.validateCardNumber($scope.card.last_digits) == true && $.payment.validateCardExpiry($scope.card.expiration_month,$scope.card.expiration_year) == true){
            $http({
                  method: 'POST',
                  url: '/clients/add_credit_card',
                  data: { 
                    id: $scope.client.id,
                    address_id: $scope.billing_address.id,
                    number: $scope.card.last_digits,
                    expiration_month: $scope.card.expiration_month,
                    expiration_year: $scope.card.expiration_year,
                    verification_code: $scope.card.cvv,
                    name: $scope.client.name,
                  },
              }).then(function successCallback(response) {
                if(response.data.error != undefined){
                  if($scope.changed_credit_card == true){
                  $scope.card = $scope.cards[$scope.credit_card_index];
                }
                else{
                  $scope.card = $scope.client.primary_credit_card;
                }
                swal("Error", response.data.error, "error");
                }
                else{
                  $scope.card = response.data;
                  $scope.cards.push($scope.card);
                  $scope.credit_card_index = $scope.cards.length - 1;
                  //console.log($scope.card);
                }
                $scope.processing = false;
                $scope.addCardProcess = false;
                $scope.edit_credit_card = 1;
              }, function errorCallback(response) {
                //console.log(response);
                $scope.processing = false;
                $scope.addCardProcess = false;
              });
          }
          else if($.payment.validateCardExpiry($scope.card.expiration_month,$scope.card.expiration_year) == false){
            $scope.processing = false;
            $scope.addCardProcess = false;
            swal("Error", "Expiration date not valid!", "warning");
          }
          else if($.payment.validateCardNumber($scope.card.last_digits) == false){
            $scope.processing = false;
            $scope.addCardProcess = false;
            swal("Error", "Card number not valid!", "warning");
          }
          else{
            $scope.processing = false;
            $scope.addCardProcess = false;
            swal("Error", "All fields are required", "warning");
          }
        }
        else if(type == "billing"){
          $scope.addBillingProcess = true;
          if($scope.billing_address.name != "" && $scope.billing_address.street_address != "" && $scope.billing_address.locality != "" && $scope.billing_address.region != "" && $scope.billing_address.postal_code != "" && $scope.billing_address.country_code != ""){
            $http({
                  method: 'POST',
                  url: '/clients/add_address',
                  data: { 
                    id: $scope.client.id,
                    name: $scope.billing_address.name,
                    street_address: $scope.billing_address.street_address,
                    locality: $scope.billing_address.locality,
                    region: $scope.billing_address.region,
                    postal_code: $scope.billing_address.postal_code,
                    country_code: $scope.billing_address.country_code,
                  },
              }).then(function successCallback(response) {
                $scope.billing_address = response.data;
                $scope.addresses.push($scope.billing_address);
                $scope.billing_address_index = $scope.addresses.length - 1;
                //console.log($scope.billing_address);
                $scope.edit_billing = 1;
                $scope.processing = false;
                $scope.addBillingProcess = false;
              }, function errorCallback(response) {
                //console.log(response);
                $scope.processing = false;
                $scope.addBillingProcess = false;
              });
          }
          else{
            $scope.processing = false;
              $scope.addBillingProcess = false;
              swal("Error", "All fields are required", "warning");
          }
        }
      }

      $scope.confirmPay = function(){
        $scope.processing = true;
        $scope.payProcess = true;
        $scope.edit_deliver = 1;
        $scope.edit_billing = 1;
        $scope.edit_credit_card = 1;
        if($rootScope.isLoggedin == true){
          if($scope.last_digits == ""){
            $scope.processing = false;
            $scope.payProcess = false;
            swal("Error", "No credit card selected", "warning");
          }
          else{
            var service_type = "LEAST_EXPENSIVE"
            if($("#shipping option:selected").text() == "Priority Overnight"){
              service_type = "PRIORITY_OVERNIGHT";
            }
            else if($("#shipping option:selected").text() == "FedEx 2 Day"){
              service_type = "FEDEX_2_DAY";
            }
            var type = $scope.ticket.format;
            if($scope.ticket.format == "Physical"){
              type = "FedEx";
            }
            else if($scope.ticket.format == "Eticket"){
              type = "Eticket";
            }
            else if($scope.ticket.format == "Flash_seats"){
              type = "FlashSeats";
            }
            else if($scope.ticket.format == "TM_mobile"){
              type = "TMMobile";
            }
                    var away_team = "";
                    if($scope.event.away_performer != undefined){
                        away_team = $scope.event.away_performer.name
                    }
            $http({
                  method: 'POST',
                  url: '/orders/create',
                  data: { 
                    user_id: $rootScope.user.te_uid,
                    billing_address_id: $scope.billing_address.id,
                    ship_address_id: $scope.shipping_address.id,
                    credit_card_id: $scope.card.id,
                    quantity: $scope.amount,
                    ticket_group_id: $scope.ticket.id,
                    price: $scope.ticket.retail_price,
                    ticket_group_signature: $scope.ticket.signature,
                    type: type,
                    service_type: service_type,
                    ship_to_name: $rootScope.user.name,
                    amount: Number($scope.total.toFixed(2)),
                    email_address_id: $scope.client.primary_email_address.id,
                    pay_type: "credit_card",
                    shipment_price: Number($scope.shipping_fee),
                    session_id: $scope.session_id,
                    user_agent: navigator.userAgent,
                    selectedPhone: $scope.client.primary_phone_number.id,
                    event_id: $scope.event.id,
                    event_name: $scope.event.name,
                    event_occurs_at: $scope.event.occurs_at,
                    event_location: $scope.event.venue.name + ", " +$scope.event.location,
                    section: $scope.ticket.section,
                    row: $scope.ticket.row,
                    ticket_type: $scope.ticket.format,
                    service_fee:  Number($scope.service_fee.toFixed(2)),
                    ticket_format: $scope.ticket.format,
                    cost: $scope.ticket.wholesale_price,
                    discount: Number($scope.discount.toFixed(2)),
                    subtotal: Number($scope.subtotal.toFixed(2)),
                    email: $scope.client.primary_email_address.address,
                    broker_name: $scope.ticket.office.name,
                    last_digits: $scope.card.last_digits,
                    address: $scope.shipping_address.street_address,
                    phone: $scope.client.primary_phone_number.number,
                    event_home_team: $scope.event.home_performer.name,
                    event_away_team: away_team,
                    event_te_uid: $scope.event.id,
                    ticket_notes: $scope.ticket.public_notes,
                    sport_id: $scope.event.home_performer.sport.id
                  },
              }).then(function successCallback(response) {
                $scope.processing = false;
                $scope.payProcess = false;
                if(response.data.error == undefined){
                  $scope.order = response.data;
                  $scope.order_success = true;
                  // Create transaction
                  Analytics.addTrans($scope.order.id, 'www.gamehedge.com', $scope.total, 0, 0);
                  // Add items to transaction
                Analytics.addItem($scope.order.id, $scope.ticket.id, $scope.event.name, $scope.event.sport.name, $scope.ticket.retail_price, Number($scope.amount));
                // Complete transaction
                Analytics.trackTrans();
                
                $scope.goToConfirm();
                // Clear transaction
                // Analytics.clearTrans();
                  //console.log("Order");
                  //console.log($scope.order);
                }
                else{
                  console.log("Error");
                  console.log(response);
                  swal("Error", response.data.error, "error");
                }
              }, function errorCallback(response) {
                //console.log(response);
                $scope.processing = false;
                $scope.payProcess = false;
              });
          }
        }
        else{
          if($scope.client.email == "" || $scope.client.confirm_email == "" || $scope.card.last_digits == "" || $scope.card.expiration_month == "" || $scope.card.expiration_year == "" || $scope.card.cvv == "" || $scope.billing_address.name == "" || $scope.billing_address.street_address == "" || $scope.billing_address.country_code == "" || $scope.billing_address.postal_code == "" || $scope.billing_address.region == "" || $scope.billing_address.locality == "" || $scope.client.primary_phone_number.number == ""){
            $scope.processing = false;
            $scope.payProcess = false;
            $scope.edit_deliver = 3;
            $scope.edit_billing = 3;
            $scope.edit_credit_card = 3;
            swal("Error", "All fields are requierd", "warning");
          }
          else if($.payment.validateCardExpiry($scope.card.expiration_month,$scope.card.expiration_year) == false){
            $scope.processing = false;
            $scope.payProcess = false;
            $scope.edit_deliver = 3;
            $scope.edit_billing = 3;
            $scope.edit_credit_card = 3;
            swal("Error", "Expiration date not valid!", "warning");
          }
          else if($.payment.validateCardNumber($scope.card.last_digits) == false){
            $scope.processing = false;
            $scope.payProcess = false;
            $scope.edit_deliver = 3;
            $scope.edit_billing = 3;
            $scope.edit_credit_card = 3;
            swal("Error", "Card number not valid.", "warning");
          }
          else if($scope.client.email != $scope.client.confirm_email){
            $scope.processing = false;
            $scope.payProcess = false;
            $scope.edit_deliver = 3;
            $scope.edit_billing = 3;
            $scope.edit_credit_card = 3;
            swal("Error", "Email and confirm email fields shpuld be equal", "warning");
          }
          else{
            $http({
                  method: 'POST',
                  url: '/clients/create',
                  data: { 
                    name: $scope.billing_address.name,
                    email: $scope.client.email,
                    region: $scope.billing_address.region,
                    country_code: $scope.billing_address.country_code,
                    postal_code: $scope.billing_address.postal_code,
                    street_address: $scope.billing_address.street_address,
                    locality: $scope.billing_address.locality,
                    phone_number: $scope.client.primary_phone_number.number,
                  },
              }).then(function successCallback(response) {
                if(response.data.error == undefined){
                  console.log("Client created");
                  console.log("Client");
                  console.log(response.data.client);
                  console.log("User");
                            console.log(response.data.temp_password);
                  console.log(response.data.user);
                  $scope.client = response.data.client;
                  $scope.temp_password = response.data.temp_password;
                  $rootScope.isLoggedin = true;
                  $rootScope.isLoggedin = true;
                            console.log("pre login...");
                  $rootScope.user = response.data.user;
                  $scope.addresses = $scope.client.addresses;
                  $scope.billing_address = $scope.client.primary_billing_address;
                  $scope.shipping_address = $scope.client.primary_shipping_address;
                            console.log("GO TO LOGIN");
                  $scope.loginFcn();
                }
                else{
                  //console.log("Error");
                  //console.log(response);
                  $scope.processing = false;
                $scope.payProcess = false;
                $scope.edit_deliver = 3;
                $scope.edit_billing = 3;
                $scope.edit_credit_card = 3;
                swal("Error", response.data.error, "error");
                }
              }, function errorCallback(response) {
                //console.log(response);
                $scope.processing = false;
              $scope.payProcess = false;
              $scope.edit_deliver = 3;
              $scope.edit_billing = 3;
              $scope.edit_credit_card = 3;
              });
          }
          
        }
      }

      $scope.updatePassword = function(){
            
        if($scope.password == $scope.confirm_password && $scope.password != ""){
          $http({
                method: 'POST',
                url: '/clients/update_password',
                data: {password: $scope.password,
                  confirm_password: $scope.confirm_password,
                  email: $scope.client.primary_email_address.address,
                },
            }).then(function successCallback(response) {
              swal("Success", "Your password has been updated", "success");
              $scope.login2();
            }, function errorCallback(response) {
              //console.log(response);
            });
        }
        else if($scope.password == ""){
          swal("Error", "Password cannot be empty", "warning");
        }
        else{
          swal("Error", "Both password fields must be the same", "warning");
        }
      }

      $scope.loginFcn = function(){
            console.log("login ENTER");
            console.log(credentials);
        var credentials = {
                email: $scope.client.email,
                password: $scope.temp_password,
            };
            var config = {
                headers: {
                    'X-HTTP-Method-Override': 'POST'
                }
            };
            //console.log(credentials);
            Auth.login(credentials, config).then(function(user) {
                //console.log(user); // => {id: 1, ect: '...'}
            }, function(error) {
                // Authentication failed...
                //console.log("failed");
                $rootScope.user = undefined;
                $rootScope.isLoggedin = false;
                //console.log("Email or password incorrect");
            });

            $scope.$on('devise:login', function(event, currentUser) {
                // after a login, a hard refresh, a new tab
                //console.log(currentUser);
                $rootScope.user = currentUser;
                $rootScope.isLoggedin = true;
                if($scope.order_success == false){
                    $scope.createCard();
                }
            });

            $scope.$on('devise:new-session', function(event, currentUser) {
                // user logged in by Auth.login({...})
            });
      }

      $scope.login2 = function(){
        var credentials = {
                email: $scope.client.primary_email_address.address,
                password: $scope.password,
            };
            var config = {
                headers: {
                    'X-HTTP-Method-Override': 'POST'
                }
            };
            //console.log(credentials);
            Auth.login(credentials, config).then(function(user) {
                //console.log(user); // => {id: 1, ect: '...'}
            }, function(error) {
                // Authentication failed...
                //console.log("failed");
                $rootScope.user = undefined;
                $rootScope.isLoggedin = false;
                //console.log("Email or password incorrect");
            });

            $scope.$on('devise:login', function(event, currentUser) {
                // after a login, a hard refresh, a new tab
                //console.log(currentUser);
                $rootScope.user = currentUser;
                $rootScope.isLoggedin = true;
                $scope.first_time = false;
            });

            $scope.$on('devise:new-session', function(event, currentUser) {
                // user logged in by Auth.login({...})
            });
      }

      $scope.checkLogin = function(){
        Auth.currentUser().then(function(user) {
              // User was logged in, or Devise returned
              // previously authenticated session.
              //console.log(user); // => {id: 1, ect: '...'}
              $rootScope.user = user;
              $rootScope.isLoggedin = true;
          }, function(error) {
              // unauthenticated error
              //console.log("error login");
              $rootScope.user = undefined;
              $rootScope.isLoggedin = false;
          });
      }

      $scope.getClient = function(){
        Auth.currentUser().then(function(user) {
          $http({
                method: 'GET',
                url: '/clients/show?id='+user.te_uid,
            }).then(function successCallback(response) {
              $scope.client = response.data.client;
              $scope.cards = response.data.cards;
              $scope.addresses = response.data.client.addresses;
              //console.log("Client");
              //console.log($scope.client);
              //console.log("Cards");
              //console.log($scope.cards);
              //console.log("Addresses");
              //console.log($scope.addresses);
              $scope.edit_deliver = 1;
            $scope.edit_credit_card = 1;
            $scope.edit_billing = 1;
            $scope.shipping_address = $scope.client.primary_shipping_address;
            $scope.billing_address = $scope.client.primary_billing_address;
            $scope.card = $scope.client.primary_credit_card;
            $rootScope.isLoggedin = true;
            $rootScope.user = user;
            $scope.first_time = false;
            $('#myModal').modal('hide');
            $scope.logging_in = false;
            $scope.clientLoaded = true;
            //console.log($scope.shipping_address);

            }, function errorCallback(response) {
              $rootScope.user = undefined;
              $rootScope.isLoggedin = false;
              $scope.edit_deliver = 3;
            $scope.edit_credit_card = 3;
            $scope.edit_billing = 3;
            $scope.first_time = true;
            $scope.creditCardFieldEnable();
            $('#myModal').modal('hide');
            $scope.logging_in = false;
            $scope.clientLoaded = true;
            //console.log("Not logged in");
                //console.log(response);
            });
          }, function(error) {
            $rootScope.user = undefined;
              $rootScope.isLoggedin = false;
            $scope.edit_deliver = 3;
          $scope.edit_credit_card = 3;
          $scope.edit_billing = 3;
          $scope.first_time = true;
          $scope.clientLoaded = true;
          $scope.creditCardFieldEnable();
          //console.log("Not logged in");
              //console.log(error);
          });
      }

      $http({
            method: 'GET',
            url: '/signature?url=settings/shipping?',
        }).then(function successCallback(response) {
          $scope.shipping_list = response.data.settings;
        }, function errorCallback(response) {
            //console.log(response);
        });
        $http({
            method: 'POST',
            url: '/clients/get_session',
            data: {},
        }).then(function successCallback(response) {
          $scope.session_id = response.data;
          $("#session_iframe").html('<iframe frameborder="0" height="1" scrolling="no" src="/clients/info?session=' + $scope.session_id + '" width="1"></iframe>');
        }, function errorCallback(response) {
            //console.log(response);
        });
      // Initializers
      $scope.client = {}
      $scope.client.email = "";
      $scope.client.confirm_email = "";
      
      $scope.cards = [];
      $scope.card = {};
      $scope.card.card_company = ""
      $scope.card.cvv = ""
      $scope.card.expiration_month = ""
      $scope.card.expiration_year = ""
      $scope.card.last_digits = ""
      $scope.card.name = ""
      $scope.client.primary_phone_number = {};
      $scope.client.primary_phone_number.number = ""
      $scope.client.primary_phone_number.id = ""
      $scope.changed_credit_card = false;

      $scope.addresses = [];
      $scope.shipping_address = {};
      $scope.shipping_address.country_code = "";
      $scope.shipping_address.id = "";
      $scope.shipping_address.locality = "";
      $scope.shipping_address.name = "";
      $scope.shipping_address.postal_code = "";
      $scope.shipping_address.region = "";
      $scope.shipping_address.street_address = "";
      $scope.changed_shipping_address = false;


      $scope.billing_address = {};
      $scope.billing_address.country_code = "";
      $scope.billing_address.id = "";
      $scope.billing_address.locality = "";
      $scope.billing_address.name = "";
      $scope.billing_address.postal_code = "";
      $scope.billing_address.region = "";
      $scope.billing_address.street_address = "";
      $scope.changed_billing_address = false;
      $scope.discount = 0;
      $scope.active_promos = false;

      $scope.processing = false;
      $scope.shipping_address_index = 0;
      $scope.billing_address_index = 0;
      $scope.credit_card_index = 0;
      $scope.getPromoCodes();
      $scope.getClient();
      $rootScope.isOrder = true;
        $rootScope.isEvent = false;
      $rootScope.darkHeader = true;
      $rootScope.noFooter = true;
      $scope.order_success = false;
      $scope.editing = false;
      $scope.password = "";

      $scope.script = $("#mcafee-seal").html()
      
      $scope.searchTerm = "";
      $window.scrollTo(0, 0);





      //Login Scripts
      $scope.clearPassword = function(){
        $scope.password = "";
      }

      $scope.login = function(){
            $scope.logging_in = true;
        var credentials = {
                email: $scope.client.email,
                password: $scope.password,
            };
            var config = {
                headers: {
                    'X-HTTP-Method-Override': 'POST'
                }
            };
            //console.log(credentials);
            Auth.login(credentials, config).then(function(user) {
                //console.log(user); // => {id: 1, ect: '...'}
            }, function(error) {
                // Authentication failed...
                //console.log("failed");
                $rootScope.user = undefined;
                $rootScope.isLoggedin = false;
                $scope.logging_in = false;
                swal("Error", "Email or password incorrect. Please check amd try again.", "error");
            });

            $scope.$on('devise:login', function(event, currentUser) {
                // after a login, a hard refresh, a new tab
                //console.log(currentUser);
                $rootScope.user = currentUser;
                $rootScope.isLoggedin = true;
                $scope.getClient();
            });

            $scope.$on('devise:new-session', function(event, currentUser) {
                // user logged in by Auth.login({...})
            });
      }

        $scope.forgotPass = function(value){
            $scope.forgot_password = value;
        }

        $scope.updatePasswordAuth = function(){
            $scope.sending_password = true;
            var parameters = {
                email: $scope.client.email
            };
            
            Auth.sendResetPasswordInstructions(parameters).then(function() {
                $scope.sending_password = false;
                swal("Request submitted", "You will be receiving an email with the recovery password instructions shortly.", "success");
                
            },function(error){
                if(error.data.errors){
                    $scope.sending_password = false;
                    swal("Request failed", "E-mail not found. Please check your e-mail address.", "error");
                }
            });
        }

        $scope.showPromoField = function(){
          $scope.show_promo_field = !$scope.show_promo_field;
        }

        $scope.logging_in = false;
        $scope.clientLoaded = false;
        $scope.ticketsLoaded = false;
        $scope.sending_password = false;
        $scope.forgot_password = false;
        $scope.show_promo_field = false;
    })
    app.filter('replaceText', function () {
        return function (text) {
            if (!text) {
                return text;
            }

            return text.replace(/\_/g, ' '); // Replaces all occurences
        };
    });
    app.config(['AuthProvider',
    function(AuthProvider){
      AuthProvider.resourceName('client');
      AuthProvider.loginPath('/clients/sign_in.json');
      AuthProvider.logoutPath('/clients/sign_out.json');
      AuthProvider.sendResetPasswordInstructionsPath('/clients/password.json');
    }]);
    
</script>

