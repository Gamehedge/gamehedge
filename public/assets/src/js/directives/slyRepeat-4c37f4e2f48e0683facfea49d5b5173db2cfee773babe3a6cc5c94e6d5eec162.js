defineScalyrAngularModule("slyRepeat",["gatedScope"]).directive("slyRepeat",["$animate","$parse",function($animate){function gateWatchersForScope(elementScope){elementScope.scope.$addWatcherGate(function(){return elementScope.isActiveForRepeat})}return{restrict:"A",scope:!0,transclude:"element",priority:1e3,terminal:!0,compile:function(element,attr,linker){return function($scope,$element,$attr){var expression=$attr.slyRepeat,match=expression.match(/^\s*(.+)\s+in\s+(.*?)$/);if(!match)throw Error("Expected slyRepeat in form of '_item_ in _collection_' but got '"+expression+"'.");var iterVar=match[1],collectionExpr=match[2];if(match=iterVar.match(/^(?:([\$\w]+))$/),!match)throw Error("'item' in 'item in collection' should be identifier but got '"+lhs+"'.");var previousElements=[],previousElementBuffer=[],deregisterCallback=$scope.$watchCollection(collectionExpr,function(collection){if(collection){if(!isArray(collection))throw Error("'collection' did not evaluate to an array.  expression was "+collectionExpr);var originalPreviousElementsLength=previousElements.length;if(previousElements.length<collection.length&&previousElementBuffer.length>0){var limit=previousElements.length+previousElementBuffer.length;limit>collection.length&&(limit=collection.length),previousElements=previousElements.concat(previousElementBuffer.splice(0,limit-previousElements.length))}var currentElements=null,currentElementBuffer=[],newElements=[];if(collection.length>previousElements.length){for(var i=previousElements.length;i<collection.length;++i){var newElement={scope:$scope.$new(),isActiveForRepeat:!0};gateWatchersForScope(newElement),newElement.scope.$index=i,newElement.scope.$first=0==i,newElements.push(newElement)}currentElements=previousElements.concat(newElements),currentElementBuffer=previousElementBuffer}else if(collection.length<previousElements.length){for(var i=collection.length;i<previousElements.length;++i)previousElements[i].isActiveForRepeat=!1;currentElementBuffer=previousElements.splice(collection.length,previousElements.length-collection.length).concat(previousElementBuffer),currentElements=previousElements}else currentElements=previousElements,currentElementBuffer=previousElementBuffer;if(currentElements.length>0){var firstIndexToFix=currentElements.length-1,lastIndexToFix=currentElements.length-1;originalPreviousElementsLength<currentElements.length&&(firstIndexToFix=originalPreviousElementsLength),firstIndexToFix>0&&(firstIndexToFix-=1);for(var i=firstIndexToFix;i<=lastIndexToFix;++i)currentElements[i].scope.$last=i==currentElements.length-1,currentElements[i].scope.$middle=0!=i&&i!=currentElements.length-1,currentElements[i].isActiveForRepeat||(currentElements[i].isActiveForRepeat=!0,currentElements[i].element.css("display",""))}for(var i=0;i<currentElementBuffer.length&&!currentElementBuffer[i].isActiveForRepeat;++i)currentElementBuffer[i].element.css("display","none");for(var i=0;i<currentElements.length;++i)currentElements[i].scope[iterVar]=collection[i];var prevElement=$element;previousElements.length>0&&(prevElement=previousElements[previousElements.length-1].element);for(var i=0;i<newElements.length;++i)linker(newElements[i].scope,function(clone){$animate.enter(clone,null,prevElement),prevElement=clone,newElements[i].element=clone});previousElements=currentElements,previousElementBuffer=currentElementBuffer}});$scope.$on("$destroy",function(){deregisterCallback()})}}}}]);